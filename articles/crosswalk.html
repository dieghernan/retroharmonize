<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working with a Crosswalk Table • retroharmonize</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><link href="../deps/KaTex-0.16.10/katex.min.css" rel="stylesheet">
<script src="../deps/KaTex-0.16.10/katex.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with a Crosswalk Table">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=B612+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;family=Roboto+Mono:ital,wght@0,100..700;1,100..700&amp;display=swap" rel="stylesheet">
<!-- rogtemplate style sheet --><link href="../BS5/rogtemplate.min.css" rel="stylesheet">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">retroharmonize</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.5.003</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/retroharmonize.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rOpenGov/retroharmonize/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Working with a Crosswalk Table</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rOpenGov/retroharmonize/blob/master/vignettes/crosswalk.Rmd" class="external-link"><code>vignettes/crosswalk.Rmd</code></a></small>
      <div class="d-none name"><code>crosswalk.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://retroharmonize.dataobservatory.eu/" class="external-link">retroharmonize</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>Let’s read in the package’s small examples, and create a metadata
table from them. These steps were explained in the vignette <a href="https://retroharmonize.dataobservatory.eu/articles/metadata.html" class="external-link">Working
With Survey Metadata</a>.</p>
<p>From a technical perspective, the aim of the survey harmonization is
to create a single, tidy, joined table in the form of a data frame that
contains a row identifier, which is truly unique across all observations
and the concatenated and harmonized variables.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">examples_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples"</span>, package <span class="op">=</span> <span class="st">"retroharmonize"</span><span class="op">)</span></span>
<span><span class="va">survey_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">examples_dir</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"\\.rds"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">examples_dir</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">survey_files</span></span>
<span><span class="co">#&gt; [1] "ZA5913.rds" "ZA6863.rds" "ZA7576.rds"</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survey_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">examples_dir</span>, <span class="va">survey_files</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metadata_create.html">metadata_create</a></span><span class="op">(</span>survey_paths <span class="op">=</span> <span class="va">survey_paths</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Unknown or uninitialised column: `rowid`.</span></span>
<span><span class="co">#&gt; Read: /home/runner/work/_temp/Library/retroharmonize/examples/ZA5913.rds</span></span>
<span><span class="co">#&gt; Warning: Unknown or uninitialised column: `rowid`.</span></span>
<span><span class="co">#&gt; Read: /home/runner/work/_temp/Library/retroharmonize/examples/ZA6863.rds</span></span>
<span><span class="co">#&gt; Warning: Unknown or uninitialised column: `rowid`.</span></span>
<span><span class="co">#&gt; Read: /home/runner/work/_temp/Library/retroharmonize/examples/ZA7576.rds</span></span></code></pre></div>
<div class="section level2">
<h2 id="crosswalk-table">Crosswalk Table<a class="anchor" aria-label="anchor" href="#crosswalk-table"></a>
</h2>
<p>A schema crosswalk, or a crosswalk table is a table that shows
equivalent elements (or “fields”) in more than one survey. In this
example, we will create a crosswalk table of a subset of the tree
example surveys. We will use three variables: the unique row identifier,
the Trust in the European Parliament concept, and the country code.</p>
<p>By filtering out the other variables, we have the basic information
in our metadata table.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subset_example_metadata</span> <span class="op">&lt;-</span> <span class="va">example_metadata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^unique_identifier_in|trust|country_code"</span>, <span class="va">var_label_orig</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^unique_identifier_in|european_parliament|country_code"</span>, </span>
<span>                 <span class="va">var_label_orig</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="va">var_name_orig</span> <span class="op">!=</span> <span class="st">"uniqid"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">subset_example_metadata</span></span>
<span><span class="co">#&gt;     filename     id var_name_orig          class_orig</span></span>
<span><span class="co">#&gt; 1 ZA5913.rds ZA5913      isocntry           character</span></span>
<span><span class="co">#&gt; 2 ZA5913.rds ZA5913        qa10_1 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 3 ZA5913.rds ZA5913         rowid           character</span></span>
<span><span class="co">#&gt; 4 ZA6863.rds ZA6863      isocntry           character</span></span>
<span><span class="co">#&gt; 5 ZA6863.rds ZA6863        qa14_1      haven_labelled</span></span>
<span><span class="co">#&gt; 6 ZA6863.rds ZA6863         rowid           character</span></span>
<span><span class="co">#&gt; 7 ZA7576.rds ZA7576      isocntry           character</span></span>
<span><span class="co">#&gt; 8 ZA7576.rds ZA7576        qa14_1 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 9 ZA7576.rds ZA7576         rowid           character</span></span>
<span><span class="co">#&gt;                 var_label_orig     labels valid_labels na_labels na_range</span></span>
<span><span class="co">#&gt; 1        country_code_iso_3166         NA           NA        NA       NA</span></span>
<span><span class="co">#&gt; 2    european_parliament_trust    1, 2, 3         1, 2         3       NA</span></span>
<span><span class="co">#&gt; 3 unique_identifier_in_za_5913         NA           NA        NA       NA</span></span>
<span><span class="co">#&gt; 4        country_code_iso_3166         NA           NA        NA       NA</span></span>
<span><span class="co">#&gt; 5    european_parliament_trust    1, 2, 3      1, 2, 3                 NA</span></span>
<span><span class="co">#&gt; 6 unique_identifier_in_za_6863         NA           NA        NA       NA</span></span>
<span><span class="co">#&gt; 7        country_code_iso_3166         NA           NA        NA       NA</span></span>
<span><span class="co">#&gt; 8    european_parliament_trust 1, 2, 3, 9      1, 2, 3         9       NA</span></span>
<span><span class="co">#&gt; 9 unique_identifier_in_za_7576         NA           NA        NA       NA</span></span>
<span><span class="co">#&gt;   n_labels n_valid_labels n_na_labels</span></span>
<span><span class="co">#&gt; 1        0              0           0</span></span>
<span><span class="co">#&gt; 2        3              2           1</span></span>
<span><span class="co">#&gt; 3        0              0           0</span></span>
<span><span class="co">#&gt; 4        0              0           0</span></span>
<span><span class="co">#&gt; 5        3              3           0</span></span>
<span><span class="co">#&gt; 6        0              0           0</span></span>
<span><span class="co">#&gt; 7        0              0           0</span></span>
<span><span class="co">#&gt; 8        4              3           1</span></span>
<span><span class="co">#&gt; 9        0              0           0</span></span></code></pre></div>
<div class="section level3">
<h3 id="create-a-crosswalk-table">Create a crosswalk table<a class="anchor" aria-label="anchor" href="#create-a-crosswalk-table"></a>
</h3>
<p>You can easily create a crosswalk table with
<code><a href="../reference/crosswalk_table_create.html">crosswalk_table_create()</a></code>. Crosswalk tables are validated
with <code>is.crosswalk()</code>. You can create or modify your own
crosswalk table in any spreadsheet program. The mandatory elements of a
crosswalk table are</p>
<ul>
<li>
<code>id</code>: a unique identifier for a survey</li>
<li>
<code>filename</code>: the original source data file</li>
<li>
<code>var_name_orig</code>: the original variable name at
source</li>
<li>
<code>var_name_target</code>: the original variable name after using
the crosswalk, by default, it equal to <code>var_name_orig</code>.</li>
</ul>
<p>All other columns are optional because they are needed for specific
tasks, namely to change the numeric coding and labelling of valid and
special survey response values, or to harmonize the eventual R type
representation of the data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/crosswalk_table_create.html">crosswalk_table_create</a></span><span class="op">(</span><span class="va">subset_example_metadata</span><span class="op">)</span></span>
<span><span class="va">ct</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 16</span></span></span>
<span><span class="co">#&gt;    id     filename   var_name_orig var_name_target val_numeric_orig</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ZA5913 ZA5913.rds isocntry      isocntry                      <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ZA5913 ZA5913.rds qa10_1        qa10_1                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ZA5913 ZA5913.rds qa10_1        qa10_1                         2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ZA5913 ZA5913.rds qa10_1        qa10_1                         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ZA5913 ZA5913.rds rowid         rowid                         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ZA6863 ZA6863.rds isocntry      isocntry                      <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ZA6863 ZA6863.rds qa14_1        qa14_1                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ZA6863 ZA6863.rds qa14_1        qa14_1                         2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ZA6863 ZA6863.rds qa14_1        qa14_1                         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ZA6863 ZA6863.rds rowid         rowid                         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> ZA7576 ZA7576.rds isocntry      isocntry                      <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> ZA7576 ZA7576.rds qa14_1        qa14_1                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> ZA7576 ZA7576.rds qa14_1        qa14_1                         2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> ZA7576 ZA7576.rds qa14_1        qa14_1                         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> ZA7576 ZA7576.rds qa14_1        qa14_1                         9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> ZA7576 ZA7576.rds rowid         rowid                         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 11 more variables: val_numeric_target &lt;dbl&gt;, val_label_orig &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   val_label_target &lt;chr&gt;, class_orig &lt;chr&gt;, class_target &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   na_label_orig &lt;chr&gt;, na_label_target &lt;chr&gt;, na_numeric_orig &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   na_numeric_target &lt;dbl&gt;, var_label_orig &lt;chr&gt;, var_label_target &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="variable-name-harmonization">Variable name harmonization<a class="anchor" aria-label="anchor" href="#variable-name-harmonization"></a>
</h3>
<p>The harmonization of the variable names requires a single,
unambiguous name for the variables that represent the same concept:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> var_name_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span></span>
<span>    <span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"rowid"</span> <span class="op">~</span> <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span>, </span>
<span>    <span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"isocntry"</span> <span class="op">~</span>  <span class="st">"geo"</span>, </span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"trust_ep"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span> <span class="op">(</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"filename"</span>, <span class="st">"var_name_orig"</span>, <span class="st">"var_name_target"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 3</span></span></span>
<span><span class="co">#&gt;   filename   var_name_orig var_name_target</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ZA5913.rds isocntry      geo            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ZA5913.rds qa10_1        trust_ep       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ZA5913.rds rowid         rowid          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ZA6863.rds isocntry      geo            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ZA6863.rds qa14_1        trust_ep       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ZA6863.rds rowid         rowid          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> ZA7576.rds isocntry      geo            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> ZA7576.rds qa14_1        trust_ep       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> ZA7576.rds rowid         rowid</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="value-numeric-code-and-label-harmonization">Value numeric code and label harmonization<a class="anchor" aria-label="anchor" href="#value-numeric-code-and-label-harmonization"></a>
</h3>
<p>For code and label harmonization, the crosswalk table should
optionally contain instructions on harmonizing the numeric value codes
and value labels.</p>
<ul>
<li>The <code><a href="../reference/crosswalk_table_create.html">crosswalk_table_create()</a></code> will create identical
source and target columns for labeling (and type setting.)</li>
<li>You can save this table into <code>.csv</code> or <code>.xls</code>
and edit it in a spreadsheet application if you want. If you do not
change the default values (<code>source</code>=<code>target</code>) then
the harmonization in those aspects will not take place.</li>
</ul>
<p>In this example, for full reproducability, we do not work in a
spreadsheet program like Excel or Numbers or OpenOffice but we create
programatically an unambiguous coding. To be on the safe side, the
special missing value is placed far away from the normal values.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> val_numeric_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span></span>
<span>    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="va">.data</span><span class="op">$</span><span class="va">val_numeric_orig</span>, </span>
<span>    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="fl">0</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">99999</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> val_label_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span></span>
<span>    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"trust"</span>, </span>
<span>    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"distrust"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"declined"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span> <span class="op">(</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"filename"</span>, </span>
<span>                             <span class="st">"val_numeric_orig"</span>, <span class="st">"val_numeric_target"</span>, </span>
<span>                             <span class="st">"val_label_orig"</span>,  <span class="st">"val_label_target"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>             <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 13 × 5</span></span></span>
<span><span class="co">#&gt;    filename  val_numeric_orig val_numeric_target val_label_orig val_label_target</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ZA5913.r…               <span style="color: #BB0000;">NA</span>              <span style="text-decoration: underline;">99</span>999 <span style="color: #BB0000;">NA</span>             declined        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ZA5913.r…                1                  1 Tend to trust  trust           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ZA5913.r…                2                  0 Tend not to t… distrust        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ZA5913.r…                3              <span style="text-decoration: underline;">99</span>999 DK             declined        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ZA6863.r…               <span style="color: #BB0000;">NA</span>              <span style="text-decoration: underline;">99</span>999 <span style="color: #BB0000;">NA</span>             declined        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ZA6863.r…                1                  1 Tend to trust  trust           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ZA6863.r…                2                  0 Tend not to t… distrust        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ZA6863.r…                3              <span style="text-decoration: underline;">99</span>999 DK             declined        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ZA7576.r…               <span style="color: #BB0000;">NA</span>              <span style="text-decoration: underline;">99</span>999 <span style="color: #BB0000;">NA</span>             declined        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ZA7576.r…                1                  1 Tend to trust  trust           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> ZA7576.r…                2                  0 Tend not to t… distrust        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> ZA7576.r…                3              <span style="text-decoration: underline;">99</span>999 DK             declined        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> ZA7576.r…                9              <span style="text-decoration: underline;">99</span>999 Inap. (not CY… declined</span></span></code></pre></div>
<p>And now let’s turn our attention to the special (missing) cases.
Sometimes there may be other special cases in the code range, but the
most likely suspects are values that represent some form of missing
answers to a question or a missing questionnaire item selection.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> na_numeric_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span></span>
<span>    <span class="va">na_numeric_orig</span> <span class="op">==</span>  <span class="fl">3</span> <span class="op">~</span> <span class="fl">99999</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> na_label_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span></span>
<span>    <span class="va">na_numeric_target</span> <span class="op">==</span> <span class="fl">99999</span> <span class="op">~</span> <span class="st">"declined"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span> <span class="op">(</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"filename"</span>, <span class="st">"val_numeric_orig"</span>,  </span>
<span>                             <span class="st">"na_numeric_orig"</span>, <span class="st">"na_numeric_target"</span>,</span>
<span>                             <span class="st">"na_label_orig"</span>,  <span class="st">"na_label_target"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>             <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 13 × 6</span></span></span>
<span><span class="co">#&gt;    filename   val_numeric_orig na_numeric_orig na_numeric_target na_label_orig  </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ZA5913.rds               <span style="color: #BB0000;">NA</span>              <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ZA5913.rds                1              <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ZA5913.rds                2              <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ZA5913.rds                3               3             <span style="text-decoration: underline;">99</span>999 DK             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ZA6863.rds               <span style="color: #BB0000;">NA</span>              <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ZA6863.rds                1              <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ZA6863.rds                2              <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ZA6863.rds                3              <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ZA7576.rds               <span style="color: #BB0000;">NA</span>              <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ZA7576.rds                1              <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> ZA7576.rds                2              <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> ZA7576.rds                3              <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> ZA7576.rds                9               9                <span style="color: #BB0000;">NA</span> Inap. (not CY-…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: na_label_target &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a-reproducible-recoding-and-relabelling">A reproducible recoding and relabelling<a class="anchor" aria-label="anchor" href="#a-reproducible-recoding-and-relabelling"></a>
</h3>
<p>Let’s put the entire process into a tidyverse pipeline with <a href="https://dplyr.tidyverse.org/" class="external-link">dplyr</a>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_crosswalk_table</span> <span class="op">&lt;-</span> <span class="va">ct</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> var_name_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span></span>
<span>    <span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"rowid"</span> <span class="op">~</span> <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span>, </span>
<span>    <span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"isocntry"</span> <span class="op">~</span>  <span class="st">"geo"</span>, </span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"trust_ep"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> val_numeric_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span></span>
<span>    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="va">.data</span><span class="op">$</span><span class="va">val_numeric_orig</span>, </span>
<span>    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="fl">0</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">99999</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> val_label_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span></span>
<span>    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"trust"</span>, </span>
<span>    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"distrust"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"declined"</span></span>
<span>  <span class="op">)</span><span class="op">)</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> na_numeric_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span></span>
<span>    <span class="va">na_numeric_orig</span> <span class="op">==</span>  <span class="fl">3</span> <span class="op">~</span> <span class="fl">99999</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> na_label_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span></span>
<span>    <span class="va">na_numeric_target</span> <span class="op">==</span> <span class="fl">99999</span> <span class="op">~</span> <span class="st">"declined"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">example_crosswalk_table</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 16</span></span></span>
<span><span class="co">#&gt;    id     filename   var_name_orig var_name_target val_numeric_orig</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ZA5913 ZA5913.rds isocntry      geo                           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ZA5913 ZA5913.rds qa10_1        trust_ep                       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ZA5913 ZA5913.rds qa10_1        trust_ep                       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ZA5913 ZA5913.rds qa10_1        trust_ep                       3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ZA5913 ZA5913.rds rowid         rowid                         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ZA6863 ZA6863.rds isocntry      geo                           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ZA6863 ZA6863.rds qa14_1        trust_ep                       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ZA6863 ZA6863.rds qa14_1        trust_ep                       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ZA6863 ZA6863.rds qa14_1        trust_ep                       3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ZA6863 ZA6863.rds rowid         rowid                         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> ZA7576 ZA7576.rds isocntry      geo                           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> ZA7576 ZA7576.rds qa14_1        trust_ep                       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> ZA7576 ZA7576.rds qa14_1        trust_ep                       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> ZA7576 ZA7576.rds qa14_1        trust_ep                       3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> ZA7576 ZA7576.rds qa14_1        trust_ep                       9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> ZA7576 ZA7576.rds rowid         rowid                         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 11 more variables: val_numeric_target &lt;dbl&gt;, val_label_orig &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   val_label_target &lt;chr&gt;, class_orig &lt;chr&gt;, class_target &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   na_label_orig &lt;chr&gt;, na_label_target &lt;chr&gt;, na_numeric_orig &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   na_numeric_target &lt;dbl&gt;, var_label_orig &lt;chr&gt;, var_label_target &lt;chr&gt;</span></span></span></code></pre></div>
<p>Needless to say that you do not need to work with <em>dplyr</em>.</p>
<p>Reading the crosswalk table is very simple, for example, the last two
(15-16) rows read like this:</p>
<ul>
<li>In <code>ZA6863.rds</code> rename the variable storing questionnaire
item <code>qa14_1</code> to <code>trust_ep</code>
(<code>Trust in European Parliament</code>).<br>
</li>
<li>Recode the numeric values from <code>2</code> to <code>0</code> and
label them as <code>distrust</code>.</li>
<li>Recode the special values from <code>3</code> to <code>99999</code>
and label them as <code>declined</code>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="subsetting">Subsetting<a class="anchor" aria-label="anchor" href="#subsetting"></a>
</h3>
<p>From a technical perspective, the aim of the survey harmonization is
to create a single, tidy, joined table. For making joining possible (and
to reduce memory use), a first processing step is to remove irrelevant
variables that will not be harmonized.</p>
<p>There are several ways how the subsetting can be made. With smaller
tasks all the surveys can be stored in memory and the subsequent
processing made fast in memory. With many surveys, we provide a slower
but memory-saving way of importing and subsetting consecutive surveys
from files.</p>
<p>Recall from the vignette <a href="https://retroharmonize.dataobservatory.eu/articles/metadata.html" class="external-link">Working
With Survey Metadata</a> that you can read files into a list of
surveys:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_surveys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_surveys.html">read_surveys</a></span> <span class="op">(</span><span class="va">survey_paths</span>, .f <span class="op">=</span> <span class="st">"read_rds"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Unknown or uninitialised column: `rowid`.</span></span>
<span><span class="co">#&gt; Unknown or uninitialised column: `rowid`.</span></span>
<span><span class="co">#&gt; Unknown or uninitialised column: `rowid`.</span></span></code></pre></div>
<p>Now let’s focus of our attention to a small subset of the
variables.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subset_survey_list_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_surveys.html">subset_surveys</a></span><span class="op">(</span>survey_list <span class="op">=</span> <span class="va">example_surveys</span>, </span>
<span>                                       subset_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowid"</span>, <span class="st">"isocntry"</span>, <span class="st">"qa10_1"</span>, <span class="st">"qa14_1"</span><span class="op">)</span>, </span>
<span>                                       subset_name <span class="op">=</span> <span class="st">"subset_example"</span><span class="op">)</span></span></code></pre></div>
<p>We still have the three surveys in a list:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">subset_survey_list_1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"id"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ZA5913" "ZA6863" "ZA7576"</span></span></code></pre></div>
<p>The top few rows of the first subsetted survey to see if the
subsetting took place:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">subset_survey_list_1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unknown A (????). "Untitled Dataset."</span></span>
<span><span class="co">#&gt;   rowid   isocntry qa10_1               </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl+lbl&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ZA5913_ NL       2<span style="color: #949494;"> [Tend not to trust]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ZA5913_ NL       2<span style="color: #949494;"> [Tend not to trust]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ZA5913_ NL       3<span style="color: #BB0000;"> (NA)</span><span style="color: #949494;"> [DK]</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ZA5913_ NL       1<span style="color: #949494;"> [Tend to trust]</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ZA5913_ NL       1<span style="color: #949494;"> [Tend to trust]</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ZA5913_ NL       1<span style="color: #949494;"> [Tend to trust]</span></span></span></code></pre></div>
<p>While <code>qa10_1</code> and <code>qa14_1</code> refer to trust in
the European Parliament, they cannot be joined because they have
dissimilar names. These names are not too easy to remember, either.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span> <span class="op">(</span><span class="va">subset_survey_list_1</span>, <span class="va">names</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "rowid"    "isocntry" "qa10_1"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "rowid"    "isocntry" "qa14_1"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] "rowid"    "isocntry" "qa14_1"</span></span></code></pre></div>
<p>The next step is to harmonize the names of those variables that
represent the same concept, in this case, <em>Trust in the European
Parliament</em>. The next steps, i.e. the harmonization of the numerical
codes of answers and their labels will be discussed in the <a href="https://retroharmonize.dataobservatory.eu/articles/harmonize_labels.html" class="external-link">Harmonize
Value Labels</a> vignette.</p>
</div>
</div>
<div class="section level2">
<h2 id="variable-name-harmonization-1">Variable Name Harmonization<a class="anchor" aria-label="anchor" href="#variable-name-harmonization-1"></a>
</h2>
<p>It is very practical to do the subsetting and the variable name
harmonization in one step. The <code><a href="../reference/subset_surveys.html">subset_save_surveys()</a></code>
function will do this optionally, and a wrapper function
<code>harmonize_surveys()</code> will validate that all metadata
(i.e. the original, source variable names and the new, target variable
names) are present.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subset_survey_list_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_surveys.html">subset_surveys</a></span><span class="op">(</span>crosswalk_table <span class="op">=</span> <span class="va">example_crosswalk_table</span>, </span>
<span>                                       survey_list <span class="op">=</span> <span class="va">example_surveys</span>,</span>
<span>                                       subset_name <span class="op">=</span> <span class="st">"trust_ep"</span><span class="op">)</span></span></code></pre></div>
<p>We have again the three surveys in a list:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">subset_survey_list_2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"id"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ZA5913" "ZA6863" "ZA7576"</span></span></code></pre></div>
<p>The top few rows of the first subsetted survey now show that we have
new, harmonized names.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">subset_survey_list_2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unknown A (????). "Untitled Dataset."</span></span>
<span><span class="co">#&gt;   rowid   isocntry qa10_1               </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl+lbl&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ZA5913_ NL       2<span style="color: #949494;"> [Tend not to trust]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ZA5913_ NL       2<span style="color: #949494;"> [Tend not to trust]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ZA5913_ NL       3<span style="color: #BB0000;"> (NA)</span><span style="color: #949494;"> [DK]</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ZA5913_ NL       1<span style="color: #949494;"> [Tend to trust]</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ZA5913_ NL       1<span style="color: #949494;"> [Tend to trust]</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ZA5913_ NL       1<span style="color: #949494;"> [Tend to trust]</span></span></span></code></pre></div>
<p>Our variable names are harmonized:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span> <span class="op">(</span><span class="va">subset_survey_list_2</span>, <span class="va">names</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "rowid"    "isocntry" "qa10_1"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "rowid"    "isocntry" "qa14_1"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] "rowid"    "isocntry" "qa14_1"</span></span></code></pre></div>
<p>While this example easily fits in the memory, when working with
several dozens of SPSS files, it is better to sequentially import the
surveys from file, and save the output to files. By default, the
parameters <code>import_path</code> and <code>export_path</code> are set
to <code>NULL</code>. If you enter a valid path to a directory, the
function will look for the files specified in the
<code>crosswalk_table$filename</code> on this path.</p>
<ul>
<li>If you do not specify the <code>export_path</code>, a list of
surveys will be returned.</li>
<li>If you specify the <code>export_path</code>, a vector of the saved
file names (with full path) will be returned.</li>
</ul>
<p>The <code><a href="../reference/subset_surveys.html">subset_surveys()</a></code> is a versatile function that fits
with several workflows. It works in memory or with larger tasks, with
sequentially read survey files; it for simple tasks it can use a simple
vector for names to keep, or it can use an entire crosswalk table. You
can read more about it with <code><a href="../reference/subset_surveys.html">?subset_surveys</a></code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/subset_surveys.html">subset_surveys</a></span><span class="op">(</span>survey_list <span class="op">=</span> <span class="va">example_surveys</span>, </span>
<span>               crosswalk_table <span class="op">=</span> <span class="va">example_crosswalk_table</span>, </span>
<span>               subset_name <span class="op">=</span> <span class="st">"trust_ep"</span>,</span>
<span>               import_path <span class="op">=</span> <span class="va">examples_dir</span>, </span>
<span>               export_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Saving ZA5913_trust_ep.rds</span></span>
<span><span class="co">#&gt; Saving ZA6863_trust_ep.rds</span></span>
<span><span class="co">#&gt; Saving ZA7576_trust_ep.rds</span></span>
<span><span class="co">#&gt; [1] "ZA5913_trust_ep.rds" "ZA6863_trust_ep.rds" "ZA7576_trust_ep.rds"</span></span></code></pre></div>
<p>The subsetted surveys are saved with a common name element,
<code>trust_ep</code> to the export file location, in this case a
temporary directory created with <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"ZA5913_trust_ep.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unknown A (????). "Untitled Dataset."</span></span>
<span><span class="co">#&gt;   rowid   isocntry qa10_1               </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl+lbl&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ZA5913_ NL       2<span style="color: #949494;"> [Tend not to trust]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ZA5913_ NL       2<span style="color: #949494;"> [Tend not to trust]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ZA5913_ NL       3<span style="color: #BB0000;"> (NA)</span><span style="color: #949494;"> [DK]</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ZA5913_ NL       1<span style="color: #949494;"> [Tend to trust]</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ZA5913_ NL       1<span style="color: #949494;"> [Tend to trust]</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ZA5913_ NL       1<span style="color: #949494;"> [Tend to trust]</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="further-steps">Further Steps<a class="anchor" aria-label="anchor" href="#further-steps"></a>
</h2>
<p>Having a subsetted list of surveys with harmonized variable names is
usually not yet an output that is ready for statistical analysis. In the
next step, the numerical codes, the variable labels need to be made
consistent, with a special attention given to special values,
particularly to missing values.</p>
<p>At last, if the statistical analysis will take place in R, a
conversion to basic R classes is necessary to rely on the vast arsenal
of R’s statistical packages. This means that the survey data must be
brought to a consistent numeric or a consistent factor format (and in
some cases, for visualization, to a character format).</p>
<p>We created a special s3 class (see
<code><a href="../reference/labelled_spss_survey.html">?labelled_spss_survey</a></code>), which retains the metadata about
coding and special values, and created three methods that take into
consideration the retained metadata. For example, if 999 is the code for
declined answers, then the base are <code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric()</a></code> will
coerce observations (survey responses) with a value <code>999</code> to
a numerical value of <code>999</code>, but the <code><a href="../reference/labelled_spss_survey.html">as_numeric()</a></code>
method will give a <code>NA_real_</code> representation to this
observation. Averaging numerical, coded values will give a logically
wrong result with the basic as.numeric, but a correct with the
<code><a href="../reference/labelled_spss_survey.html">as_numeric()</a></code> method.</p>
<p>The crosswalk table is a map for value code and label harmonization,
and for type conversion, too. This is the topic of the <a href="https://retroharmonize.dataobservatory.eu/articles/harmonize_labels.html" class="external-link">Harmonize
Value Labels</a> vignette.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://reprex.nl/authors/daniel_antal/" class="external-link">Daniel Antal</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>



    <!-- Add ropengov logo -->
  <script src="../BS5/logo.js"></script>
</body>
</html>
