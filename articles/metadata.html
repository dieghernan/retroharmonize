<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working With Survey Metadata • retroharmonize</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><link href="../deps/KaTex-0.16.10/katex.min.css" rel="stylesheet">
<script src="../deps/KaTex-0.16.10/katex.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working With Survey Metadata">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=B612+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;family=Roboto+Mono:ital,wght@0,100..700;1,100..700&amp;display=swap" rel="stylesheet">
<!-- rogtemplate style sheet --><link href="../BS5/rogtemplate.min.css" rel="stylesheet">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">retroharmonize</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.5.003</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/retroharmonize.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rOpenGov/retroharmonize/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Working With Survey Metadata</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rOpenGov/retroharmonize/blob/master/vignettes/metadata.Rmd" class="external-link"><code>vignettes/metadata.Rmd</code></a></small>
      <div class="d-none name"><code>metadata.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://retroharmonize.dataobservatory.eu/" class="external-link">retroharmonize</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">examples_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples"</span>, package <span class="op">=</span> <span class="st">"retroharmonize"</span><span class="op">)</span></span>
<span><span class="va">survey_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">examples_dir</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"\\.rds"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">examples_dir</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">survey_files</span></span>
<span><span class="co">#&gt; [1] "ZA5913.rds" "ZA6863.rds" "ZA7576.rds"</span></span></code></pre></div>
<div class="section level2">
<h2 id="working-with-a-single-survey">Working With a Single Survey<a class="anchor" aria-label="anchor" href="#working-with-a-single-survey"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survey_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_rds.html">read_rds</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">examples_dir</span>, <span class="va">survey_files</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Unknown or uninitialised column: `rowid`.</span></span></code></pre></div>
<p>This function should be renamed and slightly rewritten, it does too
many things.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/metadata_create.html">metadata_create</a></span><span class="op">(</span><span class="va">survey_1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;            filename     id var_name_orig          class_orig</span></span>
<span><span class="co">#&gt; ZA5913.1 ZA5913.rds ZA5913           doi           character</span></span>
<span><span class="co">#&gt; ZA5913.2 ZA5913.rds ZA5913       version           character</span></span>
<span><span class="co">#&gt; ZA5913.3 ZA5913.rds ZA5913        uniqid             numeric</span></span>
<span><span class="co">#&gt; ZA5913.4 ZA5913.rds ZA5913      isocntry           character</span></span>
<span><span class="co">#&gt; ZA5913.5 ZA5913.rds ZA5913            p1      haven_labelled</span></span>
<span><span class="co">#&gt; ZA5913.6 ZA5913.rds ZA5913            p3 haven_labelled_spss</span></span>
<span><span class="co">#&gt;                                           var_label_orig</span></span>
<span><span class="co">#&gt; ZA5913.1                       digital_object_identifier</span></span>
<span><span class="co">#&gt; ZA5913.2                  gesis_archive_version_and_date</span></span>
<span><span class="co">#&gt; ZA5913.3 unique_respondent_id_caseid_by_tns_country_code</span></span>
<span><span class="co">#&gt; ZA5913.4                           country_code_iso_3166</span></span>
<span><span class="co">#&gt; ZA5913.5                               date_of_interview</span></span>
<span><span class="co">#&gt; ZA5913.6                   duration_of_interview_minutes</span></span>
<span><span class="co">#&gt;                                                 labels</span></span>
<span><span class="co">#&gt; ZA5913.1                                            NA</span></span>
<span><span class="co">#&gt; ZA5913.2                                            NA</span></span>
<span><span class="co">#&gt; ZA5913.3                                            NA</span></span>
<span><span class="co">#&gt; ZA5913.4                                            NA</span></span>
<span><span class="co">#&gt; ZA5913.5 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14</span></span>
<span><span class="co">#&gt; ZA5913.6                                   2, 225, 999</span></span>
<span><span class="co">#&gt;                                           valid_labels na_labels na_range</span></span>
<span><span class="co">#&gt; ZA5913.1                                            NA        NA       NA</span></span>
<span><span class="co">#&gt; ZA5913.2                                            NA        NA       NA</span></span>
<span><span class="co">#&gt; ZA5913.3                                            NA        NA       NA</span></span>
<span><span class="co">#&gt; ZA5913.4                                            NA        NA       NA</span></span>
<span><span class="co">#&gt; ZA5913.5 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14                 NA</span></span>
<span><span class="co">#&gt; ZA5913.6                                        2, 225       999       NA</span></span>
<span><span class="co">#&gt;          n_labels n_valid_labels n_na_labels</span></span>
<span><span class="co">#&gt; ZA5913.1        0              0           0</span></span>
<span><span class="co">#&gt; ZA5913.2        0              0           0</span></span>
<span><span class="co">#&gt; ZA5913.3        0              0           0</span></span>
<span><span class="co">#&gt; ZA5913.4        0              0           0</span></span>
<span><span class="co">#&gt; ZA5913.5       14             14           0</span></span>
<span><span class="co">#&gt; ZA5913.6        3              2           1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="working-with-multiple-surveys">Working With Multiple Surveys<a class="anchor" aria-label="anchor" href="#working-with-multiple-surveys"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survey_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">examples_dir</span>, <span class="va">survey_files</span><span class="op">)</span></span></code></pre></div>
<p>With smaller data frames representing your surveys, the most
efficient way to work with the information is to read them into a list
of surveys.</p>
<p>Read the surveys into a list object in the memory:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_surveys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_surveys.html">read_surveys</a></span><span class="op">(</span><span class="va">survey_paths</span>, .f <span class="op">=</span> <span class="st">"read_rds"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Unknown or uninitialised column: `rowid`.</span></span>
<span><span class="co">#&gt; Unknown or uninitialised column: `rowid`.</span></span>
<span><span class="co">#&gt; Unknown or uninitialised column: `rowid`.</span></span></code></pre></div>
<p>Map the metadata contents of the files:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/metadata_create.html">metadata_create</a></span><span class="op">(</span>survey_list <span class="op">=</span> <span class="va">example_surveys</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="co">#&gt;      filename     id var_name_orig          class_orig</span></span>
<span><span class="co">#&gt; 1  ZA6863.rds ZA6863        qa8a_3 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 2  ZA6863.rds ZA6863         qd7.8      haven_labelled</span></span>
<span><span class="co">#&gt; 3  ZA5913.rds ZA5913            p3 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 4  ZA7576.rds ZA7576         qd6.3 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 5  ZA5913.rds ZA5913        qa10_2 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 6  ZA5913.rds ZA5913            p4      haven_labelled</span></span>
<span><span class="co">#&gt; 7  ZA7576.rds ZA7576            p2      haven_labelled</span></span>
<span><span class="co">#&gt; 8  ZA7576.rds ZA7576        qa6a_8 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 9  ZA5913.rds ZA5913           doi           character</span></span>
<span><span class="co">#&gt; 10 ZA6863.rds ZA6863           d60      haven_labelled</span></span>
<span><span class="co">#&gt; 11 ZA5913.rds ZA5913        qd3_12      haven_labelled</span></span>
<span><span class="co">#&gt; 12 ZA7576.rds ZA7576            d8      haven_labelled</span></span>
<span><span class="co">#&gt;                                var_label_orig               labels</span></span>
<span><span class="co">#&gt; 1                  trust_in_institutions_army           1, 2, 3, 9</span></span>
<span><span class="co">#&gt; 2            important_values_pers_solidarity                 0, 1</span></span>
<span><span class="co">#&gt; 3               duration_of_interview_minutes          2, 225, 999</span></span>
<span><span class="co">#&gt; 4          important_values_pers_human_rights              0, 1, 9</span></span>
<span><span class="co">#&gt; 5                   european_commission_trust              1, 2, 3</span></span>
<span><span class="co">#&gt; 6       n_of_persons_present_during_interview           1, 2, 3, 4</span></span>
<span><span class="co">#&gt; 7                           time_of_interview  1, 2, 3, 4, 5, 6, 8</span></span>
<span><span class="co">#&gt; 8   trust_in_institutions_national_government           1, 2, 3, 9</span></span>
<span><span class="co">#&gt; 9                   digital_object_identifier                   NA</span></span>
<span><span class="co">#&gt; 10        difficulties_paying_bills_last_year           1, 2, 3, 7</span></span>
<span><span class="co">#&gt; 11 important_values_pers_respect_for_cultures                 0, 1</span></span>
<span><span class="co">#&gt; 12                              age_education 0, 2, 89, 97, 98, 99</span></span>
<span><span class="co">#&gt;            valid_labels na_labels na_range n_labels n_valid_labels n_na_labels</span></span>
<span><span class="co">#&gt; 1               1, 2, 3         9       NA        4              3           1</span></span>
<span><span class="co">#&gt; 2                  0, 1                 NA        2              2           0</span></span>
<span><span class="co">#&gt; 3                2, 225       999       NA        3              2           1</span></span>
<span><span class="co">#&gt; 4                  0, 1         9       NA        3              2           1</span></span>
<span><span class="co">#&gt; 5                  1, 2         3       NA        3              2           1</span></span>
<span><span class="co">#&gt; 6            1, 2, 3, 4                 NA        4              4           0</span></span>
<span><span class="co">#&gt; 7   1, 2, 3, 4, 5, 6, 8                 NA        7              7           0</span></span>
<span><span class="co">#&gt; 8               1, 2, 3         9       NA        4              3           1</span></span>
<span><span class="co">#&gt; 9                    NA        NA       NA        0              0           0</span></span>
<span><span class="co">#&gt; 10           1, 2, 3, 7                 NA        4              4           0</span></span>
<span><span class="co">#&gt; 11                 0, 1                 NA        2              2           0</span></span>
<span><span class="co">#&gt; 12 0, 2, 89, 97, 98, 99                 NA        6              6           0</span></span></code></pre></div>
<p>If you may ran out of memory, you can work with files. The advantage
of keeping the surveys in memory is that later it will be much faster to
continue working with them, but from the metadata point of view, the
returned object is the same either way.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metadata_create.html">metadata_create</a></span> <span class="op">(</span> survey_paths <span class="op">=</span> <span class="va">survey_paths</span>, .f <span class="op">=</span> <span class="st">"read_rds"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Unknown or uninitialised column: `rowid`.</span></span>
<span><span class="co">#&gt; Read: /home/runner/work/_temp/Library/retroharmonize/examples/ZA5913.rds</span></span>
<span><span class="co">#&gt; Warning: Unknown or uninitialised column: `rowid`.</span></span>
<span><span class="co">#&gt; Read: /home/runner/work/_temp/Library/retroharmonize/examples/ZA6863.rds</span></span>
<span><span class="co">#&gt; Warning: Unknown or uninitialised column: `rowid`.</span></span>
<span><span class="co">#&gt; Read: /home/runner/work/_temp/Library/retroharmonize/examples/ZA7576.rds</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span></span>
<span><span class="va">example_metadata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="co">#&gt;      filename     id var_name_orig          class_orig</span></span>
<span><span class="co">#&gt; 1  ZA6863.rds ZA6863        qa8a_3 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 2  ZA6863.rds ZA6863         qd7.8      haven_labelled</span></span>
<span><span class="co">#&gt; 3  ZA5913.rds ZA5913            p3 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 4  ZA7576.rds ZA7576         qd6.3 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 5  ZA5913.rds ZA5913        qa10_2 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 6  ZA5913.rds ZA5913            p4      haven_labelled</span></span>
<span><span class="co">#&gt; 7  ZA7576.rds ZA7576            p2      haven_labelled</span></span>
<span><span class="co">#&gt; 8  ZA7576.rds ZA7576        qa6a_8 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 9  ZA5913.rds ZA5913           doi           character</span></span>
<span><span class="co">#&gt; 10 ZA6863.rds ZA6863           d60      haven_labelled</span></span>
<span><span class="co">#&gt; 11 ZA5913.rds ZA5913        qd3_12      haven_labelled</span></span>
<span><span class="co">#&gt; 12 ZA7576.rds ZA7576            d8      haven_labelled</span></span>
<span><span class="co">#&gt;                                var_label_orig               labels</span></span>
<span><span class="co">#&gt; 1                  trust_in_institutions_army           1, 2, 3, 9</span></span>
<span><span class="co">#&gt; 2            important_values_pers_solidarity                 0, 1</span></span>
<span><span class="co">#&gt; 3               duration_of_interview_minutes          2, 225, 999</span></span>
<span><span class="co">#&gt; 4          important_values_pers_human_rights              0, 1, 9</span></span>
<span><span class="co">#&gt; 5                   european_commission_trust              1, 2, 3</span></span>
<span><span class="co">#&gt; 6       n_of_persons_present_during_interview           1, 2, 3, 4</span></span>
<span><span class="co">#&gt; 7                           time_of_interview  1, 2, 3, 4, 5, 6, 8</span></span>
<span><span class="co">#&gt; 8   trust_in_institutions_national_government           1, 2, 3, 9</span></span>
<span><span class="co">#&gt; 9                   digital_object_identifier                   NA</span></span>
<span><span class="co">#&gt; 10        difficulties_paying_bills_last_year           1, 2, 3, 7</span></span>
<span><span class="co">#&gt; 11 important_values_pers_respect_for_cultures                 0, 1</span></span>
<span><span class="co">#&gt; 12                              age_education 0, 2, 89, 97, 98, 99</span></span>
<span><span class="co">#&gt;            valid_labels na_labels na_range n_labels n_valid_labels n_na_labels</span></span>
<span><span class="co">#&gt; 1               1, 2, 3         9       NA        4              3           1</span></span>
<span><span class="co">#&gt; 2                  0, 1                 NA        2              2           0</span></span>
<span><span class="co">#&gt; 3                2, 225       999       NA        3              2           1</span></span>
<span><span class="co">#&gt; 4                  0, 1         9       NA        3              2           1</span></span>
<span><span class="co">#&gt; 5                  1, 2         3       NA        3              2           1</span></span>
<span><span class="co">#&gt; 6            1, 2, 3, 4                 NA        4              4           0</span></span>
<span><span class="co">#&gt; 7   1, 2, 3, 4, 5, 6, 8                 NA        7              7           0</span></span>
<span><span class="co">#&gt; 8               1, 2, 3         9       NA        4              3           1</span></span>
<span><span class="co">#&gt; 9                    NA        NA       NA        0              0           0</span></span>
<span><span class="co">#&gt; 10           1, 2, 3, 7                 NA        4              4           0</span></span>
<span><span class="co">#&gt; 11                 0, 1                 NA        2              2           0</span></span>
<span><span class="co">#&gt; 12 0, 2, 89, 97, 98, 99                 NA        6              6           0</span></span></code></pre></div>
<p>A quick glance at some metadata:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">subset_example_metadata</span> <span class="op">&lt;-</span> <span class="va">example_metadata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"trust"</span>, <span class="va">.data</span><span class="op">$</span><span class="va">var_label_orig</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"european_parliament"</span>, <span class="va">.data</span><span class="op">$</span><span class="va">var_label_orig</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span> <span class="op">(</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"filename"</span>, <span class="st">"var_label_orig"</span>, <span class="st">"var_name_orig"</span>, <span class="st">"valid_labels"</span>, <span class="st">"na_labels"</span>, <span class="st">"class_orig"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">subset_example_metadata</span></span>
<span><span class="co">#&gt;     filename            var_label_orig var_name_orig valid_labels na_labels</span></span>
<span><span class="co">#&gt; 1 ZA5913.rds european_parliament_trust        qa10_1         1, 2         3</span></span>
<span><span class="co">#&gt; 2 ZA6863.rds european_parliament_trust        qa14_1      1, 2, 3          </span></span>
<span><span class="co">#&gt; 3 ZA7576.rds european_parliament_trust        qa14_1      1, 2, 3         9</span></span>
<span><span class="co">#&gt;            class_orig</span></span>
<span><span class="co">#&gt; 1 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 2      haven_labelled</span></span>
<span><span class="co">#&gt; 3 haven_labelled_spss</span></span></code></pre></div>
<p>In <code>ZA5913.rds</code> the Trust in European Parliament variable
is called <code>qa10_1</code>, in the other surveys it is called
<code>qa14_1</code>.</p>
<p>In the first survey, the variable has two values (coded as 1 and 2,
and labelled as <code>Tend to trust</code> and
<code>Tend not to trust</code>. )</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">subset_example_metadata</span><span class="op">$</span><span class="va">valid_labels</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Tend to trust Tend not to trust </span></span>
<span><span class="co">#&gt;                 1                 2</span></span></code></pre></div>
<p>In the first survey, the variable has two values (coded as 1 and 2,
and labelled as <code>Tend to trust</code> and
<code>Tend not to trust</code>.) In the second survey, we have three
values, and non of them are marked as special, missing values. This is
not surprising, because they were not SPSS files. They have related, but
not exactly matching classes, too. Therefore, these variables need to be
harmonized.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">subset_example_metadata</span><span class="op">$</span><span class="va">valid_labels</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Tend to trust Tend not to trust                DK </span></span>
<span><span class="co">#&gt;                 1                 2                 3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">subset_example_metadata</span><span class="op">$</span><span class="va">na_labels</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; numeric(0)</span></span></code></pre></div>
<p>The metadata created by the <code><a href="../reference/metadata_create.html">metadata_create()</a></code> and its
version for multiple surveys, <code>metadata_create</code>, gives a
first overview for the harmonization of concepts, the necessary
harmonization of variable names and variable labels. In this case:</p>
<ul>
<li>Variable name harmonization is required: For a successful join, you
must use a common name for <code>qa10_1</code> and <code>qa14_1</code>,
for example, <code>trust_european_parliament</code>, because the
variable refers to the same concept.</li>
<li>Variable label harmonization is required: You must make sure that
the variable has three categories, even if one category,
<code>Declined</code> (to answer) is missing from
<code>ZA5913.rds</code>.</li>
<li>Type harmonization is needed: For various statistical procedures you
must convert the concatenated contents of <code>qa10_1</code> and
<code>qa14_1</code> into a numerical variable or factor variable. It is
practical to use <em>1=“Tend to Trust”</em>, <em>0=“Tend not to
trust”</em> for calculating the percentage of people trusting the
European Parliament, making sure that Decline will get a
<code>NA_real_</code> value for averaging, or creating a factor variable
with three levels, for example <em>trust</em>, <em>not_trust</em>,
<em>declined</em>.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://reprex.nl/authors/daniel_antal/" class="external-link">Daniel Antal</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>



    <!-- Add ropengov logo -->
  <script src="../BS5/logo.js"></script>
</body>
</html>
