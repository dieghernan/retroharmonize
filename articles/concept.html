<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Harmonizing Concepts, Questions, and Variables • retroharmonize</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><link href="../deps/KaTex-0.16.10/katex.min.css" rel="stylesheet">
<script src="../deps/KaTex-0.16.10/katex.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Harmonizing Concepts, Questions, and Variables">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=B612+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;family=Roboto+Mono:ital,wght@0,100..700;1,100..700&amp;display=swap" rel="stylesheet">
<!-- rogtemplate style sheet --><link href="../BS5/rogtemplate.min.css" rel="stylesheet">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">retroharmonize</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.5.003</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/retroharmonize.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rOpenGov/retroharmonize/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Harmonizing Concepts, Questions, and Variables</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rOpenGov/retroharmonize/blob/master/vignettes/concept.Rmd" class="external-link"><code>vignettes/concept.Rmd</code></a></small>
      <div class="d-none name"><code>concept.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://retroharmonize.dataobservatory.eu/" class="external-link">retroharmonize</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>The first step of retrospective harmonization is finding the relevant
concepts, operationalized in questions that need to be harmonized among
two or more surveys.</p>
<div class="section level2">
<h2 id="concept">Concept<a class="anchor" aria-label="anchor" href="#concept"></a>
</h2>
</div>
<div class="section level2">
<h2 id="questions">Questions<a class="anchor" aria-label="anchor" href="#questions"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">examples_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples"</span>, package <span class="op">=</span> <span class="st">"retroharmonize"</span><span class="op">)</span></span>
<span><span class="va">survey_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">examples_dir</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"\\.rds"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">examples_dir</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">survey_files</span></span>
<span><span class="co">#&gt; [1] "ZA5913.rds" "ZA6863.rds" "ZA7576.rds"</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survey_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">examples_dir</span>, <span class="va">survey_files</span><span class="op">)</span></span></code></pre></div>
<p>With smaller data frames representing your surveys, the most
efficient way to work with the information is to read them into a list
of surveys.</p>
<p>Read the surveys into a list object in the memory:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_surveys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_surveys.html">read_surveys</a></span><span class="op">(</span><span class="va">survey_paths</span>, .f <span class="op">=</span> <span class="st">"read_rds"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Unknown or uninitialised column: `rowid`.</span></span>
<span><span class="co">#&gt; Unknown or uninitialised column: `rowid`.</span></span>
<span><span class="co">#&gt; Unknown or uninitialised column: `rowid`.</span></span></code></pre></div>
<p>If you may ran out of memory, you can work with files. The advantage
of keeping the surveys in memory is that later it will be much faster to
continue working with them, but from the metadata point of view, the
returned object is the same either way.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#not evaluated</span></span>
<span><span class="va">example_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metadata_create.html">metadata_create</a></span> <span class="op">(</span>survey_paths <span class="op">=</span> <span class="va">survey_paths</span>, .f <span class="op">=</span> <span class="st">"read_rds"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Unknown or uninitialised column: `rowid`.</span></span>
<span><span class="co">#&gt; Read: /home/runner/work/_temp/Library/retroharmonize/examples/ZA5913.rds</span></span>
<span><span class="co">#&gt; Warning: Unknown or uninitialised column: `rowid`.</span></span>
<span><span class="co">#&gt; Read: /home/runner/work/_temp/Library/retroharmonize/examples/ZA6863.rds</span></span>
<span><span class="co">#&gt; Warning: Unknown or uninitialised column: `rowid`.</span></span>
<span><span class="co">#&gt; Read: /home/runner/work/_temp/Library/retroharmonize/examples/ZA7576.rds</span></span></code></pre></div>
<p>Let’s work in the memory now. Map the metadata contents of the
files:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/metadata_create.html">metadata_create</a></span><span class="op">(</span>survey_list <span class="op">=</span> <span class="va">example_surveys</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="co">#&gt;      filename     id var_name_orig          class_orig</span></span>
<span><span class="co">#&gt; 1  ZA6863.rds ZA6863        qa8a_3 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 2  ZA6863.rds ZA6863         qd7.8      haven_labelled</span></span>
<span><span class="co">#&gt; 3  ZA5913.rds ZA5913            p3 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 4  ZA7576.rds ZA7576         qd6.3 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 5  ZA5913.rds ZA5913        qa10_2 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 6  ZA5913.rds ZA5913            p4      haven_labelled</span></span>
<span><span class="co">#&gt; 7  ZA7576.rds ZA7576            p2      haven_labelled</span></span>
<span><span class="co">#&gt; 8  ZA7576.rds ZA7576        qa6a_8 haven_labelled_spss</span></span>
<span><span class="co">#&gt; 9  ZA5913.rds ZA5913           doi           character</span></span>
<span><span class="co">#&gt; 10 ZA6863.rds ZA6863           d60      haven_labelled</span></span>
<span><span class="co">#&gt; 11 ZA5913.rds ZA5913        qd3_12      haven_labelled</span></span>
<span><span class="co">#&gt; 12 ZA7576.rds ZA7576            d8      haven_labelled</span></span>
<span><span class="co">#&gt;                                var_label_orig               labels</span></span>
<span><span class="co">#&gt; 1                  trust_in_institutions_army           1, 2, 3, 9</span></span>
<span><span class="co">#&gt; 2            important_values_pers_solidarity                 0, 1</span></span>
<span><span class="co">#&gt; 3               duration_of_interview_minutes          2, 225, 999</span></span>
<span><span class="co">#&gt; 4          important_values_pers_human_rights              0, 1, 9</span></span>
<span><span class="co">#&gt; 5                   european_commission_trust              1, 2, 3</span></span>
<span><span class="co">#&gt; 6       n_of_persons_present_during_interview           1, 2, 3, 4</span></span>
<span><span class="co">#&gt; 7                           time_of_interview  1, 2, 3, 4, 5, 6, 8</span></span>
<span><span class="co">#&gt; 8   trust_in_institutions_national_government           1, 2, 3, 9</span></span>
<span><span class="co">#&gt; 9                   digital_object_identifier                   NA</span></span>
<span><span class="co">#&gt; 10        difficulties_paying_bills_last_year           1, 2, 3, 7</span></span>
<span><span class="co">#&gt; 11 important_values_pers_respect_for_cultures                 0, 1</span></span>
<span><span class="co">#&gt; 12                              age_education 0, 2, 89, 97, 98, 99</span></span>
<span><span class="co">#&gt;            valid_labels na_labels na_range n_labels n_valid_labels n_na_labels</span></span>
<span><span class="co">#&gt; 1               1, 2, 3         9       NA        4              3           1</span></span>
<span><span class="co">#&gt; 2                  0, 1                 NA        2              2           0</span></span>
<span><span class="co">#&gt; 3                2, 225       999       NA        3              2           1</span></span>
<span><span class="co">#&gt; 4                  0, 1         9       NA        3              2           1</span></span>
<span><span class="co">#&gt; 5                  1, 2         3       NA        3              2           1</span></span>
<span><span class="co">#&gt; 6            1, 2, 3, 4                 NA        4              4           0</span></span>
<span><span class="co">#&gt; 7   1, 2, 3, 4, 5, 6, 8                 NA        7              7           0</span></span>
<span><span class="co">#&gt; 8               1, 2, 3         9       NA        4              3           1</span></span>
<span><span class="co">#&gt; 9                    NA        NA       NA        0              0           0</span></span>
<span><span class="co">#&gt; 10           1, 2, 3, 7                 NA        4              4           0</span></span>
<span><span class="co">#&gt; 11                 0, 1                 NA        2              2           0</span></span>
<span><span class="co">#&gt; 12 0, 2, 89, 97, 98, 99                 NA        6              6           0</span></span></code></pre></div>
<p>The current retroharmonize uses the metadata_create() function to
restore the encoded metadata into a tidy table that can be the start of
further steps. This function should be revised after much use, and
brought to a simpler format, and renamed, preferably choosing a DDI
Glossary term. (Ingest? Or just mapping? Should not contain any
tidyverse verbs.) C2: The selected variables from the metadata table
(which needs a better word) we subset the surveys either in memory or,
in case of many files, sequentially from file. This the subset_survey()
function. It will need a thorough upgrade to correctly retain the
attributes of the datacube-inheritted new survey class, but it functions
well.</p>
<p>This stage should be harmonized with the <a href="https://ddialliance.org/training/getting-started-new-content/create-a-codebook" class="external-link">DDI
Codebook</a>. One problem appears to me is that DDI calls a “codebook”
differently than we do. DDI uses the term codebook on the level of file
(survey), and we use it on the level of individual observations.</p>
<blockquote>
<p>Codebook: A document that provides information on the structure,
contents, and layout of a data file. Source: <a href="https://ddialliance.org/taxonomy/term/165" class="external-link">DDI Glossary</a>.</p>
</blockquote>
<p>Here is a DDI Codebook example in <a href="https://ddialliance.org/sites/default/files/National%20Household%20Survey,%202011%20%5bCanada%5d%20Public%20Use%20Microdata%20File%20(PUMF)-%20Individuals%20File.pdf" class="external-link">PDF</a>.</p>
<p>Because normally we want to use standardized codes, and we started to
harmonize with the SDMX statistical metadata standard, a good resolution
seems to be to differentiate between a Codebook (DDI term) and a
Codelist (SDMX term, but I am sure it has a more general RDF
definition.)</p>
<p>We roughly have a DDI Codebook regarding the concepts and question
items, but the number of Valid and Invalid responses were not collected
at ingestion:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">example_metadata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span> <span class="op">(</span> Filename <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">filename</span>,</span>
<span>           Name <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span>, </span>
<span>           Label <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">var_label_orig</span>, </span>
<span>           Type <span class="op">=</span>  <span class="va">.data</span><span class="op">$</span><span class="va">class_orig</span>, </span>
<span>           Format <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">labels</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> Valid <span class="op">=</span> <span class="cn">NA_real_</span>, </span>
<span>           Invalid <span class="op">=</span> <span class="cn">NA_real_</span>, </span>
<span>           Question <span class="op">=</span> <span class="cn">NA_character_</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Use of .data in tidyselect expressions was deprecated in tidyselect 1.2.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `"filename"` instead of `.data$filename`</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Warning: Use of .data in tidyselect expressions was deprecated in tidyselect 1.2.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `"var_name_orig"` instead of `.data$var_name_orig`</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Warning: Use of .data in tidyselect expressions was deprecated in tidyselect 1.2.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `"var_label_orig"` instead of `.data$var_label_orig`</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Warning: Use of .data in tidyselect expressions was deprecated in tidyselect 1.2.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `"class_orig"` instead of `.data$class_orig`</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Warning: Use of .data in tidyselect expressions was deprecated in tidyselect 1.2.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `"labels"` instead of `.data$labels`</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt;      Filename     Name                                    Label</span></span>
<span><span class="co">#&gt; 1  ZA7576.rds serialid       serial_case_id_appointed_by_kantar</span></span>
<span><span class="co">#&gt; 2  ZA6863.rds   qd7.13         important_values_pers_none_spont</span></span>
<span><span class="co">#&gt; 3  ZA7576.rds isocntry                    country_code_iso_3166</span></span>
<span><span class="co">#&gt; 4  ZA6863.rds    qd7.2 important_values_pers_respect_human_life</span></span>
<span><span class="co">#&gt; 5  ZA5913.rds   qd3_14                 important_values_pers_dk</span></span>
<span><span class="co">#&gt; 6  ZA7576.rds       w3                           weight_germany</span></span>
<span><span class="co">#&gt; 7  ZA6863.rds       w1    weight_result_from_target_redressment</span></span>
<span><span class="co">#&gt; 8  ZA7576.rds    qd6.5          important_values_pers_democracy</span></span>
<span><span class="co">#&gt; 9  ZA7576.rds    qd6.1        important_values_pers_rule_of_law</span></span>
<span><span class="co">#&gt; 10 ZA6863.rds      doi                digital_object_identifier</span></span>
<span><span class="co">#&gt; 11 ZA7576.rds   qa6b_2 trust_in_institutions_european_union_tcc</span></span>
<span><span class="co">#&gt; 12 ZA7576.rds   qa6a_5               trust_in_institutions_army</span></span>
<span><span class="co">#&gt;                   Type     Format Valid Invalid Question</span></span>
<span><span class="co">#&gt; 1              numeric         NA    NA      NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2       haven_labelled       0, 1    NA      NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3            character         NA    NA      NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4       haven_labelled       0, 1    NA      NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5       haven_labelled       0, 1    NA      NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6              numeric         NA    NA      NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 7              numeric         NA    NA      NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8  haven_labelled_spss    0, 1, 9    NA      NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 9  haven_labelled_spss    0, 1, 9    NA      NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10           character         NA    NA      NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 haven_labelled_spss 1, 2, 3, 9    NA      NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12 haven_labelled_spss 1, 2, 3, 9    NA      NA     &lt;NA&gt;</span></span></code></pre></div>
<p>The DDI Codebook is however, a lot more, because it contains
survey-level metadata that we did not use in retroharmonize so far. We
assumed that the user (researcher) did a comparison of sampling methods,
collection modes, etc, which are all part of the DDI Codebook
standard.</p>
<p>It would be very easy to write a codebook_create() function that
would create a partial DDI codebook as a component of a future DDI
Codebook function codebook_create_ddi() and keep working with this.</p>
<p>However, we have a problem, the current, released retroharmonize has
a more complex <code><a href="../reference/create_codebook.html">create_codebook()</a></code> function. This should be
depracted.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">my_codebook</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_codebook.html">create_codebook</a></span> <span class="op">(</span></span>
<span> survey <span class="op">=</span> <span class="fu"><a href="../reference/read_rds.html">read_rds</a></span> <span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples"</span>, <span class="st">"ZA7576.rds"</span>,</span>
<span>                      package <span class="op">=</span> <span class="st">"retroharmonize"</span><span class="op">)</span></span>
<span>          <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Unknown or uninitialised column: `rowid`.</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="va">my_codebook</span>, <span class="fl">12</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 12</span></span></span>
<span><span class="co">#&gt;    entry id     filename   var_name_orig var_label_orig            val_code_orig</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>    29 ZA7576 ZA7576.rds qa6a_4        trust_in_institutions_po… 1            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>    11 ZA7576 ZA7576.rds nuts          region_nuts_codes         TR82         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    11 ZA7576 ZA7576.rds nuts          region_nuts_codes         TR41         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>    11 ZA7576 ZA7576.rds nuts          region_nuts_codes         LV005        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>    11 ZA7576 ZA7576.rds nuts          region_nuts_codes         FR23         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>    29 ZA7576 ZA7576.rds qa6a_4        trust_in_institutions_po… 9            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>    11 ZA7576 ZA7576.rds nuts          region_nuts_codes         AL033        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>    35 ZA7576 ZA7576.rds qa6b_3        trust_in_institutions_un… 3            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>    11 ZA7576 ZA7576.rds nuts          region_nuts_codes         EL13         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    11 ZA7576 ZA7576.rds nuts          region_nuts_codes         BE35         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>    11 ZA7576 ZA7576.rds nuts          region_nuts_codes         BE21         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>    12 ZA7576 ZA7576.rds d7            marital_status            8            </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: val_label_orig &lt;chr&gt;, label_range &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   na_range &lt;named list&gt;, n_labels &lt;dbl&gt;, n_valid_labels &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   n_na_labels &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reproducible-research-tasks">Reproducible research tasks<a class="anchor" aria-label="anchor" href="#reproducible-research-tasks"></a>
</h2>
<p>The tasks that we do with this information is variable name and
variable label harmonization.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metadata_create.html">metadata_create</a></span><span class="op">(</span><span class="va">example_surveys</span><span class="op">)</span></span>
<span><span class="va">metadata</span><span class="op">$</span><span class="va">var_name_suggested</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/label_normalize.html">label_normalize</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">var_name</span><span class="op">)</span></span>
<span><span class="va">metadata</span><span class="op">$</span><span class="va">var_name_suggested</span><span class="op">[</span><span class="va">metadata</span><span class="op">$</span><span class="va">label_orig</span> <span class="op">==</span> <span class="st">"age_education"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"age_education"</span></span>
<span></span>
<span><span class="va">harmonized_example_surveys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/harmonize_var_names.html">harmonize_var_names</a></span><span class="op">(</span>survey_list <span class="op">=</span> <span class="va">example_surveys</span>, </span>
<span>                                                  metadata    <span class="op">=</span> <span class="va">metadata</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">harmonized_example_surveys</span>, <span class="va">names</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;  [1] "doi"      "version"  "uniqid"   "isocntry" "p1"       "p3"      </span></span>
<span><span class="co">#&gt;  [7] "p4"       "nuts"     "d7"       "d8"       "d25"      "d60"     </span></span>
<span><span class="co">#&gt; [13] "qa10_3"   "qa10_2"   "qa10_1"   "qa7_4"    "qa7_2"    "qa7_3"   </span></span>
<span><span class="co">#&gt; [19] "qa7_1"    "qa7_5"    "qd3_1"    "qd3_2"    "qd3_3"    "qd3_4"   </span></span>
<span><span class="co">#&gt; [25] "qd3_5"    "qd3_6"    "qd3_7"    "qd3_8"    "qd3_9"    "qd3_10"  </span></span>
<span><span class="co">#&gt; [31] "qd3_11"   "qd3_12"   "qd3_13"   "qd3_14"   "w1"       "w3"      </span></span>
<span><span class="co">#&gt; [37] "rowid"   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;  [1] "doi"      "version"  "uniqid"   "serialid" "isocntry" "p1"      </span></span>
<span><span class="co">#&gt;  [7] "p2"       "p3"       "p4"       "nuts"     "d7"       "d8"      </span></span>
<span><span class="co">#&gt; [13] "d25"      "d60"      "qa14_3"   "qa14_2"   "qa14_1"   "qa8a_3"  </span></span>
<span><span class="co">#&gt; [19] "qa8a_9"   "qa8b_2"   "qa8a_1"   "qa8a_7"   "qa8a_8"   "qa8a_2"  </span></span>
<span><span class="co">#&gt; [25] "qa8a_5"   "qa8b_1"   "qa8a_4"   "qa8a_6"   "qa8a_10"  "qa8b_3"  </span></span>
<span><span class="co">#&gt; [31] "qd7 1"    "qd7 2"    "qd7 3"    "qd7 4"    "qd7 5"    "qd7 6"   </span></span>
<span><span class="co">#&gt; [37] "qd7 7"    "qd7 8"    "qd7 9"    "qd7 10"   "qd7 11"   "qd7 12"  </span></span>
<span><span class="co">#&gt; [43] "qd7 13"   "qd7 14"   "w1"       "w3"       "wex"      "rowid"   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;  [1] "doi"      "version"  "uniqid"   "caseid"   "serialid" "isocntry"</span></span>
<span><span class="co">#&gt;  [7] "p1"       "p2"       "p3"       "p4"       "nuts"     "d7"      </span></span>
<span><span class="co">#&gt; [13] "d8"       "d25"      "d60"      "qa14_5"   "qa14_3"   "qa14_2"  </span></span>
<span><span class="co">#&gt; [19] "qa14_4"   "qa14_1"   "qa6a_5"   "qa6a_10"  "qa6b_2"   "qa6a_3"  </span></span>
<span><span class="co">#&gt; [25] "qa6a_1"   "qa6b_4"   "qa6a_8"   "qa6a_9"   "qa6a_4"   "qa6a_2"  </span></span>
<span><span class="co">#&gt; [31] "qa6b_1"   "qa6a_6"   "qa6a_7"   "qa6a_11"  "qa6b_3"   "qd6 1"   </span></span>
<span><span class="co">#&gt; [37] "qd6 2"    "qd6 3"    "qd6 4"    "qd6 5"    "qd6 6"    "qd6 7"   </span></span>
<span><span class="co">#&gt; [43] "qd6 8"    "qd6 9"    "qd6 10"   "qd6 11"   "qd6 12"   "qd6 13"  </span></span>
<span><span class="co">#&gt; [49] "qd6 14"   "qg1b"     "qg8"      "w1"       "w3"       "wex"     </span></span>
<span><span class="co">#&gt; [55] "rowid"</span></span></code></pre></div>
<p>There is, however, an important extra step, what the DDI codebook
calls Type and Format matching. This is software/computer language
dependent, but our codebook could easily accommodate this with
containing the generic DDI Codebook</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span> <span class="op">(</span> </span>
<span>  Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"discrete"</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  Format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"numeric-1.0"</span>, <span class="st">"numeric-2.0"</span>, <span class="st">"numeric-6.0"</span><span class="op">)</span>,</span>
<span>  r_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"integer"</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>  range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0..9"</span>, <span class="st">"10..99"</span>, <span class="st">"100000..999999"</span> <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Type</th>
<th align="left">Format</th>
<th align="left">r_type</th>
<th align="left">range</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">discrete</td>
<td align="left">numeric-1.0</td>
<td align="left">integer</td>
<td align="left">0..9</td>
</tr>
<tr class="even">
<td align="left">discrete</td>
<td align="left">numeric-2.0</td>
<td align="left">integer</td>
<td align="left">10..99</td>
</tr>
<tr class="odd">
<td align="left">discrete</td>
<td align="left">numeric-6.0</td>
<td align="left">integer</td>
<td align="left">100000..999999</td>
</tr>
</tbody>
</table>
<p>These variables can be mapped either to our <a href="https://retroharmonize.dataobservatory.eu/articles/labelled_spss_survey.html" class="external-link">labelled_spss_survey</a>
class or Adrian Dusa’s <a href="https://github.com/dusadrian/declared" class="external-link">declared</a>.</p>
<p>Considerations: - The <em>labelled_spss_survey</em> or
<em>declared</em> is necessary because R does not have a missing case
identifier that can distinguish declined answers or answers that were
not collected. - There must be a clear coercion (without “lazy” and
ambiguous coercion) to at least R integer, numeric, character or factor
classes for further use in R’s statistical functions or visualization
functions. - Integers can easily be coerced into characters, but this is
not necessarily a good idea, because some functions anyway want a
numeric input, and characters require a lot more space to be stored in
memory or in a file.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">1982</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1982</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">1982</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1982"</span></span></code></pre></div>
<p>we can assume that we only use integer representation for coded
questionnaire items, but we still may have open text responses or
observation identifiers that are character vectors. It is likely that
the use of character-represented identifiers is a better idea in later
stages. So we must work with a class that can be converted (coerced)
into both integer (numeric) and character formats.</p>
<p>The choice has profound consequences for variable label harmonization
and the harmonization of codelists, but not at the level of concepts,
questions and codebooks.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span> <span class="op">(</span> </span>
<span>  Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"discrete"</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  Format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"numeric-1.0"</span>, <span class="st">"numeric-2.0"</span>, <span class="st">"numeric-6.0"</span><span class="op">)</span>,</span>
<span>  r_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"declared"</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>  range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male|Female|DK"</span>, <span class="st">"10..99"</span>, <span class="st">"100000..999999"</span> <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Type</th>
<th align="left">Format</th>
<th align="left">r_type</th>
<th align="left">range</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">discrete</td>
<td align="left">numeric-1.0</td>
<td align="left">declared</td>
<td align="left">Male|Female|DK</td>
</tr>
<tr class="even">
<td align="left">discrete</td>
<td align="left">numeric-2.0</td>
<td align="left">declared</td>
<td align="left">10..99</td>
</tr>
<tr class="odd">
<td align="left">discrete</td>
<td align="left">numeric-6.0</td>
<td align="left">declared</td>
<td align="left">100000..999999</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="question-banks">Question Banks<a class="anchor" aria-label="anchor" href="#question-banks"></a>
</h2>
<p>Question banks contain information about questions asked about the
same concepts in different surveys.</p>
<p>“Using DDI as a foundation for a question bank enables you to reuse
metadata and to find identical and similar questions and or response
sets across surveys for purposes of data comparison, harmonization, or
new questionnaire development.”</p>
<p><a href="https://ddialliance.org/training/getting-started/create-a-question-bank" class="external-link">Create
a Question Bank</a></p>
<p><strong>Social Science Variables Database</strong>: (located at
ICPSR) Search over 4 million variables. Also able to compare questions
across studies and series. <a href="http://www.icpsr.umich.edu/icpsrweb/ICPSR/ssvd/index.jsp" class="external-link uri">http://www.icpsr.umich.edu/icpsrweb/ICPSR/ssvd/index.jsp</a></p>
<p><strong>UK Data Service Variable and Question Bank</strong>: Search
hundreds of surveys. <a href="http://discover.ukdataservice.ac.uk/variables" class="external-link uri">http://discover.ukdataservice.ac.uk/variables</a></p>
<p><strong>Survey Data Netherlands</strong>: Over 36,000 questions to
search. <a href="http://surveydata.nl" class="external-link uri">http://surveydata.nl</a></p>
<p>Obviously we should facilitate the use of existing question banks,
and create question banks that interoperable with existing ones.</p>
<p>Let’s take a look at concerts in the Eurobarometer series. <a href="https://www.icpsr.umich.edu/web/ICPSR/series/26/variables?q=concert" class="external-link uri">https://www.icpsr.umich.edu/web/ICPSR/series/26/variables?q=concert</a>
Here is the variable that we use in our use case: <a href="https://www.icpsr.umich.edu/web/ICPSR/studies/35505/datasets/0001/variables/QB1_4?archive=icpsr" class="external-link uri">https://www.icpsr.umich.edu/web/ICPSR/studies/35505/datasets/0001/variables/QB1_4?archive=icpsr</a></p>
<p>A short caveat: the questionnaire item may or may not be copyright
protected. The reuse of the questionnaire requires further research.</p>
<p>Here we have Values (1…5) and their labels (Not in the last 12
months, 1-2 times, etc)</p>
<ul>
<li>We must clarify with Eurobarometer, Afrobarometer, etc, if we can
reuse their questions in question banks, and are researchers to use it
in harmonized surveys?</li>
</ul>
<p>The question bank information already contains information for the
next step, the harmonization of value labels and codelists not covered
in this vignette.</p>
</div>
<div class="section level2">
<h2 id="literature-review">Literature review<a class="anchor" aria-label="anchor" href="#literature-review"></a>
</h2>
<ul>
<li>Standard view in the literature on concept and question
harmonization. Any difference with ex ante and ex post
harmonization?</li>
<li>Comparison of the DDI Constructs: Concept, Question — correctly
representing this in our function descriptions and vignettes.</li>
</ul>
</div>
<div class="section level2">
<h2 id="coding-tasks-conceptcoding">Coding tasks {#concept=coding}<a class="anchor" aria-label="anchor" href="#coding-tasks-conceptcoding"></a>
</h2>
<p>We should follow the <a href="https://devguide.ropensci.org/" class="external-link">rOpenSci Packages: Development,
Maintenance, and Peer Review</a> for future changes. In designing and
deprecating functions, the relevant parts are</p>
<ul>
<li><a href="https://devguide.ropensci.org/building.html#function-and-argument-naming" class="external-link">1.3.1
Function and argument naming</a></li>
<li><a href="https://devguide.ropensci.org/evolution.html" class="external-link">15 Package
evolution - changing stuff in your package</a></li>
</ul>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/create_codebook.html">create_codebook()</a></code> will be deprecated, luckily, it does
not meet the rOpenSci object_verb suggestion.</li>
<li>
<code><a href="../reference/codebook_create.html">codebook_create()</a></code> will create a DDI-Codebook
compatible, partial codebook, only covering tasks that are relevant for
retroharmonize. The core of the codebook will be compatible with
DDI-Codebook, but further information about the R specific
implementation of the codebook will be added.</li>
<li>
<code>codebook_export_ddi()</code> will add further data (whatever
we have but do not use) to make a more complete, but not necessarily
complete DDI Codebook object. [Not a high priority now.]</li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://reprex.nl/authors/daniel_antal/" class="external-link">Daniel Antal</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>



    <!-- Add ropengov logo -->
  <script src="../BS5/logo.js"></script>
</body>
</html>
